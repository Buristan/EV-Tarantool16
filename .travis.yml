sudo: false
language: C
services:
  - docker

cache:
  directories:
    - $HOME/.cache

env:
  global:
    - PRODUCT=EV-Tarantool16
    - ARCH=x86_64
  matrix:
    - OS=el DIST=7 VAR_TARANTOOL=1.6
    - OS=el DIST=7 VAR_TARANTOOL=1.7
    - OS=el DIST=7 VAR_TARANTOOL=1.9

script:
  - git describe --long
  - git clone -b prebuild_fixes https://github.com/igorcoding/packpack.git packpack
  - packpack/packpack

before_deploy:
  - ls -l build/

deploy:
  # Deploy packages to PackageCloud
  - provider: packagecloud
    username: igorcoding
    repository: "tarantoolcontrib"
    token: ${PACKAGECLOUD_TOKEN}
    dist: ${OS}/${DIST}
    package_glob: build/*.{rpm,deb,dsc}
    skip_cleanup: true
    on:
      branch: master
      condition: -n "${OS}" && -n "${DIST}" && -n "${PACKAGECLOUD_TOKEN}" && "${VAR_TARANTOOL}" = "1.9"

notifications:
  email: true



# language: perl
# os:
#   - linux
# perl:
#   - '5.20'
#   - '5.18'
#   - '5.16'
#   - '5.14'
#   - '5.12'
#   - '5.10'
# install:
#   - provision/travis.sh
# script:
#   - perl Makefile.PL
#   - make
#   - make test
#   - make dist
# deploy:
#   provider: releases
#   skip_cleanup: true
#   api_key:
#     secure: Xnmab8XGFv2zR8OyszOeRxibYr9c3gavRyPokEPMkscOljamS9Uy0yYJ5x0sUWWozq6Dd1cg5Mkef7GG7tgSCqV+Fu57lpz4aHGu2OpnIsKGwrMDhNsS4qOYbEGpcIiE0YKRtIiGiJmK6kr8lmbCI8fdQakbW/7vZW1a1a154Aw=
#   file_glob: true
#   file: EV-Tarantool*.tar.gz
#   on:
#     tags: true
# notifications:
#   email: true
# sudo: required
